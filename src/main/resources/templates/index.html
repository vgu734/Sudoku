<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sudoku</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <form action="/start" id="header" method="post">
        <div class="selector">
            <label for="diff">Select Difficulty:</label>
            <select name="diff" id="diff">
                <option value="EASY" th:selected="${diff == T(com.vgu734.sudoku.model.Difficulty).EASY}">Easy</option>
                <option value="MEDIUM" th:selected="${diff == T(com.vgu734.sudoku.model.Difficulty).MEDIUM}">Medium</option>
                <option value="HARD" th:selected="${diff == T(com.vgu734.sudoku.model.Difficulty).HARD}">Hard</option>
                <option value="EXTREME" th:selected="${diff == T(com.vgu734.sudoku.model.Difficulty).EXTREME}">Extreme</option>
            </select>
        </div>
        <button type="submit" class="submit">Set Board</button>
    </form>
    <table id="table">
        <tr th:each="row : ${board.board}">
            <td class="cell" th:each="cell : ${row}">
                <input type="text" 
                       name="cell" 
                       th:value="${cell.value}"
                       th:attr="readonly=${cell.readOnly ? 'readonly' : null}"
                       th:classappend="${cell.readOnly ? ' read-only' : ''}" />
            </td>
        </tr>
    </table>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const cells = document.querySelectorAll('td.cell');
        
        cells.forEach(cell => {
            cell.addEventListener('click', () => {
                document.querySelectorAll('input.highlight').forEach(input => input.classList.remove('highlight'));
                document.querySelectorAll('input.select').forEach(input => input.classList.remove('select'));
                
                const input = cell.querySelector('input');
                input.classList.add('highlight');
                input.select();
                
                const rowIndex = cell.parentElement.rowIndex;
                const colIndex = cell.cellIndex;
                const val = input.value;
                
                cells.forEach(c => {
                    const cInput = c.querySelector('input');
                    if (cInput) {
                        const isSameRow = c.parentElement.rowIndex === rowIndex;
                        const isSameCol = c.cellIndex === colIndex;
                        
                        if (cInput.value !== '' && cInput.value === val) {
                            cInput.classList.add('select');
                        } else if (isSameRow || isSameCol) {
                            cInput.classList.add('highlight');
                        }
                    }
                });
            });
        });

        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            let previousValue = input.value;

            input.addEventListener('input', () => {
            	if (input.hasAttribute('readonly')) {
                    return;
                }
            	
                const value = input.value;
                if (/^[1-9]$/.test(value)) {
                    input.setAttribute('value', value);
                    previousValue = value;
                } else {
                    input.value = previousValue;
                }
            });
        });
    });

    function updateDependentWidth() {
        const table = document.getElementById('table');
        const tableWidth = table.offsetWidth;
        
        document.getElementById('header').style.width = `${tableWidth}px`;
    }
    
    window.onload = updateDependentWidth;
    window.onresize = updateDependentWidth;
    </script>
</body>
</html>
